# ğŸ“ å°ˆæ¡ˆæ¶æ§‹

> Next-AI-Draw-IO Fork çš„æŠ€è¡“æ¶æ§‹æ–‡æª”

---

## ğŸ—ï¸ æ•´é«”æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Client (Browser)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    Draw.io      â”‚    â”‚   React UI      â”‚   â”‚  WebSocket    â”‚  â”‚
â”‚  â”‚   Embed (PWA)   â”‚â—„â”€â”€â–ºâ”‚  Components     â”‚â—„â”€â”€â–ºâ”‚   Client     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                      â”‚                    â”‚
            â”‚  HTTP (6002)         â”‚  HTTP (6002)       â”‚ WS (6003)
            â–¼                      â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Server Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Next.js (Port 6002)                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ /api/chat   â”‚  â”‚ /api/mcp    â”‚  â”‚ /api/tabs           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ (AI Chat)   â”‚  â”‚ (MCP Ctrl)  â”‚  â”‚ (Tab Management)    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              WebSocket Server (Port 6003/6004)              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚   WS:6003 (Sync)   â”‚    â”‚ HTTP:6004 (MCP API)        â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ Browser â†” Server   â”‚    â”‚ MCP â†’ WS Broadcast         â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ stdio / HTTP (6004)
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MCP Server (Python)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 drawio-mcp-server (Port 6005)               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ diagram_toolsâ”‚  â”‚   tab_tools   â”‚  â”‚   diff_tools     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ (display,    â”‚  â”‚ (list, switch,â”‚  â”‚ (apply_changes,  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  modify)     â”‚  â”‚  create, save)â”‚  â”‚  get_changes)    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Model Context Protocol (stdio)
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   VS Code + GitHub Copilot                        â”‚
â”‚                   (Agent / LLM æ§åˆ¶å±¤)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§± DDD åˆ†å±¤æ¶æ§‹

```
lib/
â”œâ”€â”€ domain/                     # é ˜åŸŸå±¤ - æ ¸å¿ƒæ¥­å‹™é‚è¼¯
â”‚   â”œâ”€â”€ diagram/               # åœ–è¡¨èšåˆæ ¹
â”‚   â”‚   â”œâ”€â”€ Diagram.ts         # åœ–è¡¨å¯¦é«”
â”‚   â”‚   â”œâ”€â”€ DiagramRepository.ts # å„²å­˜åº«ä»‹é¢
â”‚   â”‚   â””â”€â”€ types.ts           # é¡å‹å®šç¾©
â”‚   â”œâ”€â”€ checkpoint/            # ç‰ˆæœ¬æ§åˆ¶èšåˆæ ¹
â”‚   â”‚   â”œâ”€â”€ Checkpoint.ts      # æª¢æŸ¥é»å¯¦é«”
â”‚   â”‚   â”œâ”€â”€ CheckpointManager.ts # Undo/Redo ç®¡ç†
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â””â”€â”€ shared/                # å…±ç”¨åŸºé¡
â”‚       â”œâ”€â”€ Entity.ts
â”‚       â”œâ”€â”€ ValueObject.ts
â”‚       â””â”€â”€ DomainEvent.ts
â”‚
â”œâ”€â”€ application/               # æ‡‰ç”¨å±¤ - ä½¿ç”¨æ¡ˆä¾‹
â”‚   â””â”€â”€ use-cases/
â”‚       â”œâ”€â”€ SaveCheckpointUseCase.ts
â”‚       â”œâ”€â”€ UndoOperationUseCase.ts
â”‚       â””â”€â”€ RedoOperationUseCase.ts
â”‚
â””â”€â”€ infrastructure/            # åŸºç¤è¨­æ–½å±¤ - æŠ€è¡“å¯¦ä½œ
    â”œâ”€â”€ drawio/
    â”‚   â””â”€â”€ DrawioAdapter.ts   # Draw.io å°è£
    â””â”€â”€ persistence/
        â””â”€â”€ LocalStorageCheckpointRepository.ts
```

---

## ğŸ³ Docker æœå‹™æ¶æ§‹

```yaml
services:
  web:        # Next.js å‰ç«¯ (Port 6002)
  ws-server:  # WebSocket Server (Port 6003, 6004)
  mcp-server: # MCP Python Server (Port 6005)
```

| æœå‹™ | æŠ€è¡“ | Port | ç”¨é€” |
|------|------|------|------|
| `web` | Next.js 15 | 6002 | å‰ç«¯ + API Routes |
| `ws-server` | Node.js | 6003, 6004 | å³æ™‚é€šè¨Š |
| `mcp-server` | Python + FastMCP | 6005 | Agent æ§åˆ¶ |

---

## ğŸ“‚ ç›®éŒ„çµæ§‹

```
next-ai-draw-io/
â”œâ”€â”€ app/                       # Next.js App Router
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ chat/             # AI èŠå¤© API
â”‚   â”‚   â”œâ”€â”€ mcp/              # MCP æ§åˆ¶ API
â”‚   â”‚   â””â”€â”€ tabs/             # åˆ†é ç®¡ç† API
â”‚   â”œâ”€â”€ about/
â”‚   â””â”€â”€ page.tsx
â”‚
â”œâ”€â”€ components/                # React å…ƒä»¶
â”‚   â”œâ”€â”€ ui/                   # åŸºç¤ UI å…ƒä»¶
â”‚   â”œâ”€â”€ chat-panel.tsx        # èŠå¤©é¢æ¿
â”‚   â”œâ”€â”€ checkpoint-controls.tsx # Undo/Redo æ§åˆ¶
â”‚   â””â”€â”€ settings-dialog.tsx   # è¨­å®šå°è©±æ¡†
â”‚
â”œâ”€â”€ contexts/                  # React Context
â”‚   â””â”€â”€ diagram-context.tsx   # åœ–è¡¨ç‹€æ…‹ç®¡ç†
â”‚
â”œâ”€â”€ hooks/                     # è‡ªè¨‚ Hooks
â”‚   â””â”€â”€ useCheckpoint.ts
â”‚
â”œâ”€â”€ lib/                       # å·¥å…·èˆ‡ DDD æ¶æ§‹
â”‚   â”œâ”€â”€ domain/               # é ˜åŸŸå±¤
â”‚   â”œâ”€â”€ application/          # æ‡‰ç”¨å±¤
â”‚   â”œâ”€â”€ infrastructure/       # åŸºç¤è¨­æ–½å±¤
â”‚   â””â”€â”€ ai-providers.ts       # AI Provider é…ç½®
â”‚
â”œâ”€â”€ mcp-server/               # Python MCP Server
â”‚   â””â”€â”€ src/drawio_mcp_server/
â”‚       â”œâ”€â”€ tools/            # MCP å·¥å…·
â”‚       â”‚   â”œâ”€â”€ diagram_tools.py
â”‚       â”‚   â”œâ”€â”€ tab_tools.py
â”‚       â”‚   â””â”€â”€ diff_tools.py
â”‚       â””â”€â”€ drawing_guidelines.py
â”‚
â”œâ”€â”€ scripts/                   # è…³æœ¬
â”‚   â””â”€â”€ ws-server.ts          # WebSocket Server
â”‚
â”œâ”€â”€ tests/                     # æ¸¬è©¦
â”‚   â”œâ”€â”€ unit/                 # Vitest å–®å…ƒæ¸¬è©¦
â”‚   â””â”€â”€ setup.ts
â”‚
â”œâ”€â”€ docker-compose.yml         # Docker ç·¨æ’
â”œâ”€â”€ Dockerfile                 # Next.js å®¹å™¨
â”œâ”€â”€ Dockerfile.ws              # WebSocket å®¹å™¨
â””â”€â”€ mcp-server/Dockerfile      # MCP å®¹å™¨
```

---

## ğŸ”„ è³‡æ–™æµ

### AI èŠå¤©æµç¨‹
```
User Input â†’ ChatPanel â†’ /api/chat â†’ AI Provider â†’ Tool Call â†’ loadDiagram()
```

### MCP æ§åˆ¶æµç¨‹
```
Copilot Agent â†’ MCP Server â†’ HTTP:6004 â†’ WS Broadcast â†’ Browser â†’ Draw.io
```

### Checkpoint æµç¨‹
```
loadDiagram() â†’ saveCheckpoint('agent') â†’ CheckpointManager â†’ Undo/Redo
```

---

## ğŸ”— ç›¸é—œæ–‡æª”

- [ROADMAP.md](./ROADMAP.md) - ç™¼å±•è·¯ç·šåœ–
- [README.md](./README.md) - å¿«é€Ÿé–‹å§‹
- [docs/DDD_ARCHITECTURE.md](./docs/DDD_ARCHITECTURE.md) - DDD è©³ç´°è¨­è¨ˆ
